---
title: "Analyse des données de consommations d'énergie en Inde"
output: html_notebook
---

# Environnement de travail

```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(ggplot2)
library(readxl)
install.packages("kableExtra")
library(knitr)
library(kableExtra)
```

# Notre base de données

Notre étude porte sur l'analyse de la consommation d'énergie dans les 33 Etats d'Inde. Il est à noter que l’Inde est le troisième producteur et le troisième consommateur d’électricité au monde.


## Import des données

Dans un premier temps, nous allons importer les données.

```{r}
data <- read.csv("long_data.csv", stringsAsFactors = T)

colnames(data) <- c("Etat", "Regions", "latitude", "longitude", "Date", "Consommation")
data <- data[,-c(3,4)]
summary(data)
# View(data)
```

Grâce à ce résumé statistique, nous pouvons voir que les valeurs de nos données sont assez étendues.\

```{r}
data$Etat[which.max(data$Consommation)]
data$Etat[which.min(data$Consommation)]
```

En effet, certaines valeurs journalières sont très faibles (inférieures à 1) alors que d'autres sont 500 fois plus élevées. Par exemple, le Maharashtra qui présente certaines valeurs très importantes en opposition avec le Sikkim. 

Concernant notre base de données, elle décrit la consommation d'énergie dans **33 Etats** d'Inde entre 2019 et 2020. \
Nous avons 16 599 lignes, soit **503 points de mesure** par pays (503*33). Les données sont journalières, exprimées en Mega Units.

```{r}
dim(data)
```


## Choix de la période étudiée

Nous allons transformer notre variable Date au format date pour poursuivre l'étude correctement.

```{r}
data$Date <- as.Date(data$Date, format = "%d/%m/%Y %H:%M:%S")
str(data) # Vérification
```

Pour simplifier notre analyse, nous allons nous concentrer seulement sur une seule année : 

```{r}
data <- data |> 
  filter(Date <= as.Date("2020-01-02"))
```

On vérifie à présent que les données que l'on va analyser correspondent bien à la période choisie. 

```{r}
min(data$Date)
max(data$Date)
```

## Normalisation des données 

Au départ, nous avons voulu normaliser les données par le nombre d'habitants de chaque Etat pour que les consommations aient le même impact dans notre étude. Cependant, cette méthode s'est révélée problématique car nous avons obtenu des valeurs très proches de zéro, ce qui aurait compliqué les calculs.

Nous avons donc choisi de réduire les données de consommation, en soustrayant la moyenne, pour continuer notre analyse avec données moins disproportionnées.

```{r}
moyenne_par_etat <- tapply(data$Consommation, data$Etat, mean)

normalized_energy <- data
for(i in 1:nrow(normalized_energy)){
  normalized_energy$Consommation[i] <- normalized_energy$Consommation[i] - moyenne_par_etat[normalized_energy$Etat[i]]
}
```


Suite à cette normailisation, nous pouvons observer une diminution importante des valeurs. Mais nous obtenons des valeurs de consommations négatives, ce qui pose problème pour l'interprétation de nos analyses. 
Nous allons donc travailler avec les valeurs initiales. 

## Représentations graphiques 

Nous allons tout d'abord représenter simplement nos données pour pouvoir faire ressortir les informations importantes. 

```{r}
# Utilisation de la fonction gather pour mettre en forme les données
# data_long <- tidyr::gather(normalized_energy, key = "Etat", value = "Consommation", -Date)

# Création du graphique avec ggplot
ggplot(data, aes(x = Date, y = Consommation, color = Etat)) +
  geom_line() +
  labs(x = "Date", y = "Consommation d'énergie", title = "Consommation d'énergie par état") +
  theme_minimal()
```
Ce graphique nous montre que nos données sont très irrégulières. \

Pour pouvoir que les informations soient plus lisibles, nous avons décidé de séparer en deux nos données. \
Nous avons fixé un seuil

```{r}

```


## Représentations graphiques 

Nous allons tout d'abord représenter simplement nos données pour pouvoir faire ressortir les informations importantes. 

```{r}
# Utilisation de la fonction gather pour mettre en forme les données
# data_long <- tidyr::gather(normalized_energy, key = "Etat", value = "Consommation", -Date)

# Création du graphique avec ggplot
ggplot(data, aes(x = Date, y = Consommation, color = Etat)) +
  geom_line() +
  labs(x = "Date", y = "Consommation d'énergie", title = "Consommation d'énergie par état") +
  theme_minimal()
```
Ce graphique nous montre que nos données sont très irrégulières. \

[Représentation des données en deux parties].{underline}

Pour pouvoir que les informations soient plus lisibles, nous avons décidé de séparer en deux nos données. \
Nous avons fixé un seuil à 100 Mega Units pour réaliser ces graphiques. 

```{r}
moyenne_par_etat <- tapply(data$Consommation, data$Etat, mean)
moyenne_par_etat <- data.frame(Etat = names(moyenne_par_etat), Moyenne = moyenne_par_etat)

data_complete <- merge(data,moyenne_par_etat, by = "Etat")
```


```{r}
data_inf <- data_complete |> 
  filter(Moyenne <= 50)
# data_inf

data_moy <- data_complete |> 
  filter(Moyenne > 50 & Moyenne < 200)
# data_moy

data_sup <- data_complete |> 
  filter(Moyenne >= 200)
# data_sup
```


```{r}
ggplot(data_inf, aes(x = Date, y = Consommation, color = Etat)) +
  geom_line() +
  labs(x = "Date", y = "Consommation d'énergie", title = "Consommation d'énergie par état", subtitle = "Pays consommant moins de 50 Mega Units en moyenne") +
  theme_minimal()

ggplot(data_moy, aes(x = Date, y = Consommation, color = Etat)) +
  geom_line() +
  labs(x = "Date", y = "Consommation d'énergie", title = "Consommation d'énergie par état", subtitle = "Pays consommant entre 50 et 200 Mega Units en moyenne") +
  theme_minimal()

ggplot(data_sup, aes(x = Date, y = Consommation, color = Etat)) +
  geom_line() +
  labs(x = "Date", y = "Consommation d'énergie", title = "Consommation d'énergie par état", subtitle = "Pays consommant plus de 200 Mega Units en moyenne") +
  theme_minimal()
```



[Représentation selon la région]{.underline}

L'inde est divisé en 5 regions : le Nord (NR), Nord-Est (NER), le Sud (SR), l'Est (ER) et l'Ouest (WR)
Nous traçons les consommations en fonction des régions (une couleur par région)

Nous calculons les moyennes des consommations par Regions:


```{r}
moyenne_par_reg <- tapply(data$Consommation, data$Regions, mean)
moyenne_par_reg <- data.frame(Regions = names(moyenne_par_reg), Moyenne_reg = moyenne_par_reg)
# 
data_complete_reg <- merge(data_complete,moyenne_par_reg, by = "Regions")
```


```{r}
data_inf <- data_complete_reg |> 
  filter(Moyenne_reg <= 66)
# data_inf

data_moy <- data_complete_reg |> 
  filter(Moyenne_reg > 66 & Moyenne_reg < 150)
# data_moy

data_sup <- data_complete_reg |> 
  filter(Moyenne_reg >= 150)
# data_sup
```


```{r}
ggplot(data, aes(x = Date, y = Consommation, color = Regions)) +
  geom_line() +
  labs(x = "Date", y = "Consommation d'énergie", title = "Consommation d'énergie par état") +
  theme_minimal()
```



```{r}
ggplot(data_inf, aes(x = Date, y = Consommation, color = Regions)) +
  geom_line() +
  labs(x = "Date", y = "Consommation d'énergie", title = "Consommation d'énergie par état", subtitle = "Pays consommant moins de 50 Mega Units en moyenne") +
  theme_minimal()

ggplot(data_moy, aes(x = Date, y = Consommation, color = Regions)) +
  geom_line() +
  labs(x = "Date", y = "Consommation d'énergie", title = "Consommation d'énergie par état", subtitle = "Pays consommant entre 50 et 200 Mega Units en moyenne") +
  theme_minimal()

ggplot(data_sup, aes(x = Date, y = Consommation, color = Regions)) +
  geom_line() +
  labs(x = "Date", y = "Consommation d'énergie", title = "Consommation d'énergie par état", subtitle = "Pays consommant plus de 200 Mega Units en moyenne") +
  theme_minimal()
```

Les représentations graphiques ne nous permettent pas de bien visualiser.

```{r}
tapply(data$Consommation, data$Regions, mean)
```
Nous observons une grande disparité entre les régions de l'Inde. En effet, le Nord-Est à une consommation très faible par rapport à l'Ouest.


```{r}
tapply(data$Consommation, data$Etat, mean)
```


# Lissage
Puisque nos signaux sont irréguliers, nous avons choisi d'utiliser les ondelettes car elles ont des bonnes propriétés de compressions et sont adaptées à ce type de données. 


Pour la courbe de température de longueur 365, on symétrise le signal à la fin pour atteindre une longueur de 512. On se ramènera à la fin au signal de départ de taille 365.

```{r}
# Extraire la colonne de consommation (ajustez le nom de la colonne si nécessaire)
y <- data$Consommation
plot(y,type="l",main="signal de départ", ylab = "Consommation")

# Créer un signal symétrisé
ysym = c(y, rev(tail(y, n = length(y) - 1)))

# Tracer le signal symétrisé
plot(ysym, type = "l", main = "Signal symétrisé", ylab = "Consommation")

# Ajouter une ligne verticale à la position 33*365 
# axe de symétrie : 365 jours et 33 pays 
abline(v = 33*365, lty = 2)
```

# A VOIR

regarder si ce qu'on a fait ce serait pas mieux avec l'autre BD




# Sources 

- base de données : https://www.kaggle.com/datasets/twinkle0705/state-wise-power-consumption-in-india?fbclid=IwAR3tNVrXpTrRlO_HVOoa53bcaTR8aR7QU_Nlbe4AhhmfzdK9ERa5Xxid1yk
- nombre d'habitants par pays : https://fr.zhujiworld.com/in/673630-tripura/?fbclid=IwAR2Ua_lx2k7u-Nil065Pw0S0mK682X7e8AuvR5CS7lfpsbUBPIlEzNiwE2Q